const SH_TIMER_PRECISION=1,SH_TIMER_STATE_STOPPED=0,SH_TIMER_STATE_PLAYING=1,SH_TIMER_DEFAULT_TIME=0,SH_TIMER_DEFAULT_INTERVAL=1e3,SH_TIMER_DEFAULT_PLAYSTATE=SH_TIMER_STATE_STOPPED,SH_TIMER_DEFAULT_SPEED=1,SH_TIMER_DEFAULT_BOTTOM_CAP=Number.NEGATIVE_INFINITY,SH_TIMER_DEFAULT_TOP_CAP=Number.POSITIVE_INFINITY,SH_TIMER_DEFAULT_LOOP=!1,SH_TIMER_DEFAULT_RAISES_EVENTS=!0;(function(){function Timer(){function e(e,n,r,o,i,a,u,T){if("boolean"==typeof e?(T=e,e=SH_TIMER_DEFAULT_TIME):"boolean"==typeof n?(T=n,n=SH_TIMER_DEFAULT_INTERVAL):"boolean"==typeof r?(T=r,r=SH_TIMER_DEFAULT_PLAYSTATE):"boolean"==typeof o?(T=o,o=SH_TIMER_DEFAULT_BOTTOM_CAP):"boolean"==typeof u&&(T=u,u=SH_TIMER_DEFAULT_SPEED),e<d.bottom||e>d.top)throw new TypeError("time lies outside of the available range of the timer");d.bottom="number"==typeof o?o:SH_TIMER_DEFAULT_BOTTOM_CAP,M.bottom=d.bottom,d.loop="boolean"==typeof a?a:SH_TIMER_DEFAULT_LOOP,M.loop=d.loop,d.speed="number"==typeof u?u:SH_TIMER_DEFAULT_SPEED,M.speed=d.speed,d.interval="number"==typeof n?n:SH_TIMER_DEFAULT_INTERVAL,M.interval=d.interval,d.time="number"==typeof e?e:SH_TIMER_DEFAULT_TIME,M.time=d.time,d.top="number"==typeof i?i:SH_TIMER_DEFAULT_TOP_CAP,M.top=d.top,j="number"==typeof r?r:SH_TIMER_DEFAULT_PLAYSTATE,M.state=j,I="boolean"==typeof T?T:SH_TIMER_DEFAULT_RAISES_EVENTS,d.state==SH_TIMER_STATE_PLAYING&&t()}function t(){P=d.time,y=Date.now(),j=SH_TIMER_STATE_PLAYING,H=M.speed,l(),v(new TimerEvent("play",d,P))}function n(){P=d.time,y=Date.now(),j=SH_TIMER_STATE_STOPPED,p(),m(),v(new TimerEvent("stop",d,P))}function r(){P=M.time,y=Date.now(),j=SH_TIMER_STATE_STOPPED,p(),m(),v(new TimerEvent("stop",d,P)),v(new TimerEvent("reset",d,P))}function o(){P=M.time,y=Date.now(),m(),v(new TimerEvent("reset",d,P))}function i(){P=d.time,y=Date.now(),H=2*M.speed,l(),v(new TimerEvent("play",d,P))}function a(){P=d.time,y=Date.now(),j=SH_TIMER_STATE_PLAYING,H=-1*M.speed,l(),v(new TimerEvent("play",d,P))}function u(){P=d.time,y=Date.now(),j=SH_TIMER_STATE_PLAYING,H=-2*M.speed,l(),v(new TimerEvent("play",d,P))}function T(e,t){var n=new TimerMarker(e,t);return w.push(n),w.length-1}function f(e){w[e]=null}function l(){null==A&&I&&(A=window.setInterval(m,SH_TIMER_PRECISION))}function p(){null!==A&&window.clearInterval(A),A=null}function m(){var e=d.time;v(new TimerEvent("update",d));var t=E(e);c(e,t),_(e,t),O=e}function E(e){var t=!1,n=j;return e>=g&&(t=!0,v(new TimerEvent("top",d,g)),L&&n?(P=R+(e-g),y=Date.now(),v(new TimerEvent("bottom",d,R))):n&&(e=g,P=g,y=Date.now(),j=SH_TIMER_STATE_STOPPED,p(),v(new TimerEvent("stop",d,g)))),R>=e&&!t&&(t=!0,v(new TimerEvent("bottom",d,R)),L&&n?(P=g-(R-e),y=Date.now(),v(new TimerEvent("top",d,g))):n&&(e=R,P=R,y=Date.now(),j=SH_TIMER_STATE_STOPPED,p(),v(new TimerEvent("stop",d,R)))),t}function c(e,t){var n=O%d.interval,r=d.time%d.interval;d.speed>0&&j>0?n>r&&v(new TimerEvent("tick",d,e)):d.speed<0&&j>0&&r>n&&v(new TimerEvent("tick",d,e))}function _(e,t){for(var n=0;n<w.length;n++){var r=w[n];if(d.speed>0&&(j>0||t)&&r){if(O<r.time&&e>r.time||e==r.time){var o=new TimerEvent("marker",r);r.callback&&r.callback(o),v(o)}}else if(d.speed<0&&(j>0||t)&&r&&(O>r.time&&e<r.time||e==r.time)){var o=new TimerEvent("marker",r);r.callback&&r.callback(o),v(o)}}}function b(e,t,n){e in k||(k[e]=[]),k[e].push(t)}function s(e,t,n){if(e in k)for(var r=k[e],o=0;o<r.length;o++)if(r[o]===t)return void r.splice(o,1)}function v(e){if(!(e.type in k))return!0;var t=k[e.type];e.target=d,t.on&&t.on.call(this,e);for(var n=0;n<t.length;n++)t[n].call(this,e);return!e.defaultPrevented}const d=this;var P,y,S,A=null,w=[],O=0,I,M={},D={};Object.defineProperty(d,"bottom",{get:function(){return R},set:function(e){R="number"==typeof e?toZero(e):SH_TIMER_DEFAULT_BOTTOM_CAP},enumerable:!0});var R=SH_TIMER_DEFAULT_BOTTOM_CAP;Object.defineProperty(d,"loop",{get:function(){return L},set:function(e){L=!!e},enumerable:!0});var L=null;Object.defineProperty(d,"speed",{get:function(){return H},set:function(e){P=toZero(d.time),y=Date.now(),H=e?e:SH_TIMER_DEFAULT_SPEED},enumerable:!0});var H=SH_TIMER_DEFAULT_SPEED;Object.defineProperty(d,"state",{get:function(){return j},enumerable:!0});var j=0;Object.defineProperty(d,"top",{get:function(){return g},set:function(e){g=e?toZero(e):SH_TIMER_DEFAULT_TOP_CAP},enumerable:!0});var g=SH_TIMER_DEFAULT_TOP_CAP;Object.defineProperty(d,"interval",{get:function(){return h},set:function(e){h=e?Math.max(1,e):SH_TIMER_DEFAULT_INTERVAL},enumerable:!0});var h=SH_TIMER_DEFAULT_INTERVAL;Object.defineProperty(d,"time",{get:function(){var e=toZero(P+(Date.now()-y)*(H*Math.min(j,1)));return e=Math.max(R,Math.min(g,e)),isNaN(e)?M.time:e},set:function(e){if(R>e||e>g)throw new TypeError("time lies outside of the available range of the timer");P=toZero(e),y=Date.now(),m()},enumerable:!0}),Object.defineProperty(d,"play",{value:t,enumerable:!0}),Object.defineProperty(d,"pause",{value:n,enumerable:!0}),Object.defineProperty(d,"stop",{value:r,enumerable:!0}),Object.defineProperty(d,"reset",{value:o,enumerable:!0}),Object.defineProperty(d,"fastForward",{value:i,enumerable:!0}),Object.defineProperty(d,"playBackward",{value:a,enumerable:!0}),Object.defineProperty(d,"fastBackward",{value:u,enumerable:!0}),Object.defineProperty(d,"addMarker",{value:T,enumerable:!0}),Object.defineProperty(d,"removeMarker",{value:f,enumerable:!0});var F=0,k={bottom:[],marker:[],pause:[],play:[],reset:[],stop:[],tick:[],top:[],update:[]};Object.defineProperty(d,"addEventListener",{value:b,enumerable:!0}),Object.defineProperty(d,"removeEventListener",{value:s,enumerable:!0}),Object.defineProperty(d,"dispatchEvent",{value:v,enumerable:!0}),Object.defineProperty(d,"onbottom",{get:function(){return k.bottom.on},set:function(e){k.bottom.on=e},enumerable:!0}),Object.defineProperty(d,"onmarker",{get:function(){return k.marker.on},set:function(e){k.marker.on=e},enumerable:!0}),Object.defineProperty(d,"onpause",{get:function(){return k.pause.on},set:function(e){k.pause.on=e},enumerable:!0}),Object.defineProperty(d,"onplay",{get:function(){return k.play.on},set:function(e){k.play.on=e},enumerable:!0}),Object.defineProperty(d,"onreset",{get:function(){return k.reset.on},set:function(e){k.reset.on=e},enumerable:!0}),Object.defineProperty(d,"onstop",{get:function(){return k.stop.on},set:function(e){k.stop.on=e},enumerable:!0}),Object.defineProperty(d,"ontick",{get:function(){return k.tick.on},set:function(e){k.tick.on=e},enumerable:!0}),Object.defineProperty(d,"ontop",{get:function(){return k.top.on},set:function(e){k.top.on=e},enumerable:!0}),Object.defineProperty(d,"onupdate",{get:function(){return k.update.on},set:function(e){k.update.on=e},enumerable:!0}),e.apply(this,arguments)}function toZero(e){return 0>e?Math.ceil(e):Math.floor(e)}Object.defineProperty(window,"Timer",{value:Timer,enumerable:!0});function TimerEvent(e,t,r){this.__proto__=new Event(e);var r="number"==typeof r?r:t.time;Object.defineProperty(this,"bubbles",{value:!1,enumerable:!0}),Object.defineProperty(this,"cancelBubble",{value:!1,enumerable:!0}),Object.defineProperty(this,"cancelable",{value:!1,enumerable:!0}),Object.defineProperty(this,"composed",{value:!1,enumerable:!0}),Object.defineProperty(this,"currentTarget",{value:!1,enumerable:!0}),Object.defineProperty(this,"defaultPrevented",{value:!1,enumerable:!0}),Object.defineProperty(this,"eventPhase",{value:0,enumerable:!0}),Object.defineProperty(this,"isTrusted",{value:!0,enumerable:!0}),Object.defineProperty(this,"path",{value:[],enumerable:!0}),Object.defineProperty(this,"returnValue",{value:r,enumerable:!0}),Object.defineProperty(this,"srcElement",{value:t,enumerable:!0}),Object.defineProperty(this,"target",{value:t,enumerable:!0}),Object.defineProperty(this,"timeStamp",{value:Date.now(),enumerable:!0}),Object.defineProperty(this,"type",{value:e,enumerable:!0})}Object.defineProperty(window,"TimerEvent",{value:TimerEvent,enumerable:!0});function TimerMarker(){function e(e,r){n=e,t=r}const r=this;var n,t;Object.defineProperty(r,"time",{get:function(){return n},enumerable:!0}),Object.defineProperty(r,"callback",{get:function(){return t},enumerable:!0}),e.apply(r,arguments)}Object.defineProperty(window,"TimerMarker",{value:TimerMarker,enumerable:!0});}());
